# CMoney è‚¡ç¥¨çˆ¬èŸ²

åŸºæ–¼ Playwright çš„ CMoney è‚¡ç¥¨è³‡æ–™çˆ¬èŸ²ï¼Œæ¡ç”¨æ¸…æ™°çš„å¤šè³‡æ–™å¤¾æ¶æ§‹çµ„ç¹”ç¨‹å¼ç¢¼ã€‚

## åŠŸèƒ½ç‰¹è‰²

- âœ… **æ¨¡çµ„åŒ–è¨­è¨ˆ**ï¼šé…ç½®ã€çˆ¬èŸ²ã€å·¥å…·å®Œå…¨åˆ†é›¢
- âœ… **éåŒæ­¥æ¶æ§‹**ï¼šä½¿ç”¨ async/await æå‡æ•ˆèƒ½
- âœ… **Response ç›£è½**ï¼šæ””æˆª API Response å–å¾—è³‡æ–™
- âœ… **è‡ªå‹•è·³éé€±æœ«**ï¼šæ™ºæ…§æ—¥æœŸè™•ç†
- âœ… **éç„¡é ­æ¨¡å¼**ï¼šå¯è¦–åŒ–ç€è¦½å™¨æ“ä½œ
- âœ… **æ‰¹æ¬¡è™•ç†**ï¼šæ”¯æ´å¤šè‚¡ç¥¨åŒæ™‚æŠ“å–
- âœ… **è³‡æ–™å„²å­˜**ï¼šè‡ªå‹•å„²å­˜ç‚º JSON æ ¼å¼

## å°ˆæ¡ˆæ¶æ§‹

```
.
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/              # é…ç½®æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ settings.py      # çˆ¬èŸ²é…ç½®è¨­å®š
â”‚   â”œâ”€â”€ crawlers/            # çˆ¬èŸ²æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ cmoney_crawler.py  # CMoney çˆ¬èŸ²æ ¸å¿ƒé¡åˆ¥
â”‚   â”œâ”€â”€ utils/               # å·¥å…·æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ date_utils.py    # æ—¥æœŸè™•ç†å·¥å…·
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ data/                    # è³‡æ–™å„²å­˜ç›®éŒ„
â”œâ”€â”€ main.py                  # ä¸»ç¨‹å¼å…¥å£
â””â”€â”€ requirements.txt         # ç›¸ä¾å¥—ä»¶
```

## å®‰è£æ­¥é©Ÿ

1. **å®‰è£ç›¸ä¾å¥—ä»¶**ï¼š
```bash
pip install -r requirements.txt
```

2. **å®‰è£ Playwright ç€è¦½å™¨**ï¼š
```bash
playwright install chromium
```

## ä½¿ç”¨æ–¹å¼

### åŸºæœ¬ä½¿ç”¨

2. **å®‰è£ Playwright ç€è¦½å™¨**ï¼š
```bash
playwright install chromium
```

## ä½¿ç”¨æ–¹æ³•

### è¨­å®šé…ç½®

ç·¨è¼¯ [src/config/settings.py](src/config/settings.py) ä¿®æ”¹é…ç½®ï¼š

```python
class CrawlerSettings:
    # è¦æŠ“å–çš„è‚¡ç¥¨
    STOCKS = {
        "è¬æµ·": "2615",
        "å°ç©é›»": "2330",
        # æ–°å¢æ›´å¤šè‚¡ç¥¨...
    }
    
    # æ—¥æœŸç¯„åœ
    START_DATE = datetime(2025, 11, 1)
    END_DATE = datetime(2025, 11, 28)
    
    # ç­‰å¾…æ™‚é–“ (ç§’)
    WAIT_AFTER_INPUT = 5
```

### åŸ·è¡Œç¨‹å¼

ç›´æ¥åŸ·è¡Œä¸»ç¨‹å¼ï¼š
```bash
python main.py
```

ç¨‹å¼æœƒè‡ªå‹•ï¼š
1. é–‹å•Ÿç€è¦½å™¨ï¼ˆéç„¡é ­æ¨¡å¼ï¼‰
2. ä¾åºæŠ“å–è¨­å®šçš„è‚¡ç¥¨è³‡æ–™
3. è‡ªå‹•è·³éé€±æœ«æ—¥æœŸ
4. å°‡è³‡æ–™å„²å­˜ç‚º JSON æ ¼å¼

## è¼¸å‡ºçµæœ

è³‡æ–™æœƒå„²å­˜åœ¨ä»¥ä¸‹æ ¼å¼çš„ç›®éŒ„ä¸­ï¼š
```
data_è‚¡ç¥¨åç¨±_è‚¡ç¥¨ä»£ç¢¼/
  â””â”€â”€ è‚¡ç¥¨ä»£ç¢¼_æ—¥æœŸ.json
```

ä¾‹å¦‚ï¼š
```
data_è¬æµ·_2615/
  â”œâ”€â”€ 2615_20251101.json
  â”œâ”€â”€ 2615_20251104.json
  â”œâ”€â”€ 2615_20251105.json
  â””â”€â”€ ...
```

æ¯å€‹ JSON æª”æ¡ˆåŒ…å«è©²æ—¥æœŸçš„å®Œæ•´è‚¡ç¥¨è³‡æ–™ã€‚

## æ¨¡çµ„èªªæ˜

### 1. é…ç½®æ¨¡çµ„ (src/config/)
- **settings.py**ï¼šé›†ä¸­ç®¡ç†æ‰€æœ‰é…ç½®åƒæ•¸
  - è‚¡ç¥¨æ¸…å–®
  - æ—¥æœŸç¯„åœ
  - URL å’Œé¸æ“‡å™¨
  - è¶…æ™‚è¨­å®š

### 2. çˆ¬èŸ²æ¨¡çµ„ (src/crawlers/)
- **cmoney_crawler.py**ï¼šCMoney çˆ¬èŸ²æ ¸å¿ƒé¡åˆ¥
  - `capture_stock()`ï¼šæŠ“å–å–®ä¸€è‚¡ç¥¨è³‡æ–™
  - `_handle_response()`ï¼šè™•ç†ç¶²è·¯å›æ‡‰
  - `_process_date()`ï¼šè™•ç†å–®ä¸€æ—¥æœŸ
  - `_save_data()`ï¼šå„²å­˜è³‡æ–™

### 3. å·¥å…·æ¨¡çµ„ (src/utils/)
- **date_utils.py**ï¼šæ—¥æœŸè™•ç†å·¥å…·
  - `is_weekend()`ï¼šåˆ¤æ–·æ˜¯å¦ç‚ºé€±æœ«
  - `generate_date_range()`ï¼šç”¢ç”Ÿæ—¥æœŸç¯„åœ

## ç¨‹å¼è¨­è¨ˆç‰¹é»

### ğŸ¯ æ¸…æ™°çš„é¡åˆ¥è¨­è¨ˆ
```python
class CMoneyCrawler:
    """CMoney è‚¡ç¥¨è³‡æ–™çˆ¬èŸ²"""
    
    async def capture_stock(self, name: str, stock_id: str):
        """æŠ“å–å–®ä¸€è‚¡ç¥¨è³‡æ–™"""
```

### ğŸ¯ Response ç›£è½æ©Ÿåˆ¶
è‡ªå‹•æ””æˆªä¸¦å„²å­˜ API å›æ‡‰ï¼š
```python
self.page.on("response", lambda response: asyncio.create_task(
    self._handle_response(response, api_pattern)
))
```

### ğŸ¯ æ™ºæ…§æ—¥æœŸè™•ç†
è‡ªå‹•è·³éé€±æœ«ï¼š
```python
for date in generate_date_range(START_DATE, END_DATE):
    if is_weekend(date):
        continue
```

### ğŸ¯ æ¨¡çµ„åŒ–æ¶æ§‹
- é…ç½®èˆ‡é‚è¼¯åˆ†é›¢
- æ˜“æ–¼ç¶­è­·å’Œæ“´å……
- å¯é‡è¤‡ä½¿ç”¨çš„å·¥å…·å‡½å¼

## è‡ªè¨‚è¨­å®šç¯„ä¾‹

### æ–°å¢æ›´å¤šè‚¡ç¥¨
ç·¨è¼¯ [src/config/settings.py](src/config/settings.py)ï¼š
```python
STOCKS = {
    "å°ç©é›»": "2330",
    "è¯ç™¼ç§‘": "2454",
    "é´»æµ·": "2317",
    "è¬æµ·": "2615",
}
```

### èª¿æ•´æ—¥æœŸç¯„åœ
```python
START_DATE = datetime(2025, 1, 1)
END_DATE = datetime(2025, 12, 31)
```

### ä¿®æ”¹ç­‰å¾…æ™‚é–“
å¦‚æœç¶²è·¯è¼ƒæ…¢ï¼Œå¯å¢åŠ ç­‰å¾…æ™‚é–“ï¼š
```python
WAIT_AFTER_INPUT = 8  # å¢åŠ åˆ° 8 ç§’
```

## æ³¨æ„äº‹é …

1. âš ï¸ ç¨‹å¼ä½¿ç”¨éç„¡é ­æ¨¡å¼ï¼Œæœƒé¡¯ç¤ºç€è¦½å™¨è¦–çª—
2. âš ï¸ è«‹ç¢ºä¿ç¶²è·¯é€£ç·šç©©å®š
3. âš ï¸ æŠ“å–å¤§é‡è³‡æ–™æ™‚è«‹æ³¨æ„å°æ–¹ä¼ºæœå™¨è² è¼‰
4. âš ï¸ è«‹éµå®ˆ CMoney ç¶²ç«™ä½¿ç”¨æ¢æ¬¾
5. âš ï¸ é€±æœ«ä¸æœƒæœ‰è‚¡å¸‚äº¤æ˜“è³‡æ–™

